(in-package :shiritori)

(defparameter *hira-resp* nil)
(defparameter *kata-resp* nil)
(defparameter hrsp nil)
(defparameter hhr "")
(defparameter hkr "")
(defparameter thr "")
(defparameter tkr "")
(defparameter resp-ix nil)
(defparameter kresp-ix nil)
(defparameter hresp-ix nil)
(defparameter word-ix nil)
(defparameter wordk-ix nil)
(defparameter endw nil)
(defparameter endr nil)
(defparameter small-kana '(12419 12421 12423 12517 12519 12515)) ; ya yu yo
(defparameter youon (mapcar (lambda (sk) (code-char sk)) small-kana))

(defun cleanp (rsp d badp badv)
  "Obtain a clean string from letter->kana functions."
  (setf cleanres
    (cleanr badp badv
      (format nil "狺蝈盹鲥殒＇铛祆蝻磲倦犷蝮洎┅┅ㄩ铒ㄥ聃犰沆遽铗弩┅沆遽铗弩┅ㄤ彐躅汨邈氕黠蜾黠蜾⒚桢汶泔眇扉犷沐鏖翳孱溟铉蝓戾螽ㄩ箦翩脶钺痱镯痿ㄧ弭栳箬黠蜾溟泗犰飒┅清脶钺翎殪骘铒瞽蝻磲觊痱镯痿箦翩孱澉ㄦ矧磲铋幄ㄥ祠蝈鲥蝮脶钺痱镯痿癌┅箦翩孱澉ㄦ矧磲铋幄ㄥ祠蝈鲥蝮黠蜾癌┅ㄩㄡ钿脶钺痱镯痿ㄦ轭孱澉秕镱呼弩＇篝蜷铉僵箦翩孱澉篚怏羼脶钺痱镯痿ō戾铉翳脶钺痱镯痿博┅ㄩㄦ轭孱澉秕镱呼弩＇篝蜷铉僵箦翩孱澉篚怏羼黠蜾ō戾铉翳黠蜾博┅┅矧矧ㄥ聃犰孱澉ㄣ狎ㄧ弭栳箬㈩溟泗瑾┅ㄥ聃犰孱澉ㄣ狎ㄧ弭栳箬㈩溟泗氇┅┅与轲脶钺ь翎殪螽ㄡ钿矧ㄥ聃犰痫螵㈩ㄥ聃犰痫螵㈩铫┅蕊铒蝓翎殪痱镨殁轸轱町矧ㄥ聃犰孱澉ㄣ狎ㄧ弭栳箬Ⅱ酡溟泗瑾┅ㄥ聃犰孱澉ㄣ狎ㄧ弭栳箬Ⅱ酡溟泗氇┅┅┅ㄤ彐躅汨邈氕蝈箴镱箦⒚桢汶躞弪泔眇扉犷沐鏖翳ь蝓戾铒翦鲥蝙＇铛祆磲疸狎灬礅溽ㄥ聃犰孱潋┅扉篝ㄣ狎ㄧ弭栳箬㈩溟泗瑾┅ㄣ狎ㄧ弭栳箬㈩溟泗氇┅㈩┅┅ㄤ彐躅躞邃蝈箴镱箦⒃蝓殒蝈箴镱箦躞邃忮骘蝈矧蝈盹鲥殒＇铛祆磲疸狎灬礅溽ㄦ轭蝈箴镱箦呼弩＇羼踽飑泔蝌蝈箴┅蝈盹鲥殒＇铛祆磲疸狎灬礅溽ㄦ轭蝈箴镱箦呼弩＇羼踽飑黩镱绛蝈箴┅┅ㄤ彐躅蝈犰黠蜾蝈箴镱箦⒚桢汶孱糸蝈眭祠榄筱蜷痿泔蝠躞骘蝈箴镱箦箦翩腩秣瞽黠蜾ㄢ祜汶铋磲痂狍＇灬礅溽雯ㄩ矧ㄥ聃犰蝈箴镱箦氅ㄥ聃犰蝈箴镱箦雯ㄥ聃犰ㄣ镱汜翦钺翦篝蜷铉蝈箴镱箦ㄦ矧磲铋幄ㄣ镤瀛汨狎辈撤珐ㄦ矧磲铋幄ㄣ镤瀛汨狎辈床珐┅雯龄篚蝓骘脶钺汨邈氘蝈趱蝾舂铋飑溟泗犰飒┅栝蜥蝈箴ㄣ戾犷蝈箴镱箦溟泗瑾忉滂忉滂雯蔑铞弪麸脶钺脶翎蝈箴ㄣ戾犷蝈箴镱箦溟泗氇忉潆忉潆雯ㄩ栝蜥蝈箴痱镧箦翩梃ㄦ矧磲铋幄ㄥ祠栝蜥蝈箴癌翳ㄦ矧磲铋幄ㄥ祠蝈鲥蝮栝蜥蝈箴癌┅清泔铞弪翦蝈箴镱箦翎殪螽ㄩㄡ钿窘戾铉翳栝蜥蝈箴博ㄦ轭篚怏羼栝蜥蝈箴博秕镱呼弩＇篝蜷铉僵箦翩梃篚怏羼栝蜥蝈箴博┅┅ㄩ脶翎蝈箴痱镧箦翩桦ㄦ矧磲铋幄ㄥ祠脶翎蝈箴癌綦ㄦ矧磲铋幄ㄥ祠蝈鲥蝮脶翎蝈箴癌┅ㄩㄡ钿窘戾铉翳栝蜥蝈箴博ㄦ轭篚怏羼脶翎蝈箴博秕镱呼弩＇篝蜷铉僵箦翩桦篚怏羼脶翎蝈箴博┅┅矧铒翦鲥蝙＇铛祆磲疸狎灬礅溽礤礅弪ㄡ痧孱犰飙脶钺犰飙脶铌楠呼弩у聃犰┅蝈盹鲥殒＇铛祆扉篝蝈箴镱箦ㄨ轵岘倦狒蝈箴镱箦脶翎捐轵蝈箴镱箦栝蜥蝈箴脶翎蝈箴ㄨ轵岘倦狒栝蜥蝈箴脶翎捐轵脶翎蝈箴┅┅腩秣瞽黠蜾┅ㄤ彐躅泔蝌邈麴ī⑿蝻眇翎殪浇蝈箴镱箦桢徜箦翩磲翥栳磲疸狎＇灬礅溽矧ㄡ钿铒ㄥ聃犰黠蜾轼┅ㄥ聃犰黠蜾轼┅ㄡ钿铒ㄥ聃犰┅ㄥ聃犰孱澉┅ㄡ钿铒ㄥ聃犰黠蜾氕轼┅ㄥ聃犰黠蜾氕轼┅┅蝈盹鲥殒＇铛祆扉篝蝈箴轼栩箴梃桦栩弩瓠轼腧弩瓠轼┅┅铒ㄥ鲥蝙＇铛祆磲翥栳┅ㄤ彐躅箦舡泔蝌邈蝈箴镱箦⒂狯弩泔蝌邈蝈箴镱箦箦狎汨弩骘磲翥栝铉泔眇豸弪蝈箴镱箦瘐箬扉篝蝈箴镱箦栝蜥蝈箴脶翎蝈箴泔蝌蝈箴箦翩泔蝌蝈箴磲疸狎灬礅溽蝈盹鲥殒＇铛祆蝈盹鲥漉痨殂狒弩呼弩у聃犰┅泔蝌蝈箴蜩遽洫描邈溟泗轱钺蝙骘痱镯痿麸汨衢蝈箴镱箦翎殪龄溟筱秭弪邃黠蜾麒孱轸桢徜磲翥桢蟋骘痱镯痿ㄢ祜汶铋磲痂狍＇灬礅溽雯麒孱矧ㄡ钿铒ㄥ聃犰雯矧ㄦ轭ㄥ祠癌孱潋ㄦ轭ㄥ祠癌翳颟ㄦ轭ㄥ祠癌綦颟┅ㄡ钿铒ㄥ聃犰氅ㄦ轭ㄥ祠癌孱潋┅蝈趱蝾氅┅溟泗┅┅ㄤ彐躅箦舡黩镱蝈箴镱箦⒂狯弩轭泔蝌邈蝈箴镱箦瘐箬扉篝蝈箴镱箦ㄧ弭栳箬蝈箴镱箦溟泗犰飒栝蜥蝈箴脶翎蝈箴黩镱绛蝈箴瘐箬黠蜾黹篌邃黠蜾螵箦翩黹篌邃黠蜾螵蝈盹鲥殒＇铛祆黹篌邃黠蜾螵┅箦翩黩镱绛蝈箴磲疸狎灬礅溽蝈盹鲥殒＇铛祆蝈盹鲥漉痨殂狒弩呼弩у聃犰┅黩镱绛蝈箴┅ㄤ彐躅汨邈氕蝈箴镱箦蝈箴镱箦⒂弭躔躞彐蹯鲠蜷徕戾螽ㄩ箦翩脶钺翎殪ㄧ弭栳箬蝈箴镱箦溟泗犰飒┅清脶钺翎殪骘铒瞽蝻磲觊蝈箴镱箦箦翩孱潋ㄦ矧磲铋幄ㄥ祠蝈鲥蝮脶钺翎殪癌┅箦翩孱潋ㄦ矧磲铋幄ㄥ祠蝈鲥蝮蝈箴镱箦癌┅箦翩栝蜥蝈箴铋义箦泔铞弪翦脶钺蝈箴镱箦螽脶翎蝈箴铋黠蜾黠蜾戾铉翳黠蜾蝈箴轼篚怏羼蝈箴镱箦暴义箴镱箦ц遽洄栩弩瓠轼脶翎捐轵蝈箴轼腧弩瓠轼ㄨ轵岘倦狒蝈箴轼酸翎脶钺鲥蝮轱町黠蜾氕轼篚怏羼ㄧ弭栳箬黠蜾溟泗犰飒ō暴酸铌榄脶钺痱镯痿翎殪咯黠蜾轼篚怏羼黠蜾ō暴┅酸铌痱镯痿翎殪ㄩ箦翩脶钺桢徜ㄧ弭栳箬蝈箴镱箦溟泗犰飒┅清脶钺桢徜骘脶铌榀脶钺蝈箴镱箦箦翩栩箴ㄦ矧磲铋幄ㄥ祠脶钺桢徜癌┅箦翩栩箴ㄦ矧磲铋幄ㄥ祠蝈箴镱箦癌┅ㄩㄡ钿脶钺桢徜窘戾铉翳脶钺桢徜博ㄦ轭篚怏羼脶钺桢徜博秕镱呼弩＇篝蜷铉僵箦翩栩箴篚怏羼脶钺桢徜博ㄩㄡ钿窘戾铉翳蝈箴镱箦博ㄦ轭篚怏羼蝈箴镱箦博秕镱呼弩＇篝蜷铉僵箦翩栩箴篚怏羼蝈箴镱箦博┅┅